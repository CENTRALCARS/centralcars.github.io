<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CENTRAL CARS</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Police Inter pour une esthétique moderne */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Styles pour masquer/afficher les modales */
        .modal-hidden {
            display: none;
        }
        .modal-visible {
            display: flex;
        }
        /* Tailwind @apply directives for custom component classes (from ANTS snippet) */
        .table-input {
            @apply w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm;
        }
        .btn {
            @apply px-4 py-2 rounded-md shadow-sm text-sm font-medium transition-colors duration-150 ease-in-out;
        }
        .btn-primary {
            @apply text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500;
        }
        .btn-secondary {
            @apply text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500;
        }
        .btn-danger {
            @apply text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-500;
        }
        .modal {
            @apply fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50 p-4;
        }
        .modal-content {
            @apply bg-white p-5 rounded-lg shadow-xl w-full max-w-md mx-auto;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-100">

    <!-- Navbar -->
    <nav class="bg-gray-800 p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center flex-wrap">
            <div class="text-white text-3xl font-bold font-inter rounded-md p-2">CENTRAL CARS</div>
            <div class="flex space-x-4 flex-wrap justify-center sm:justify-start mt-2 sm:mt-0">
                <button id="nav-home" class="text-white px-3 py-2 rounded-md text-lg font-medium transition duration-300 ease-in-out transform hover:scale-105 hover:bg-gray-700">Accueil</button>
                <button id="nav-shop" class="text-white px-3 py-2 rounded-md text-lg font-medium transition duration-300 ease-in-out transform hover:scale-105 hover:bg-gray-700">Boutique</button>
                <button id="nav-services" class="text-white px-3 py-2 rounded-md text-lg font-medium transition duration-300 ease-in-out transform hover:scale-105 hover:bg-gray-700">Nos Services</button>
                <button id="nav-contact" class="text-white px-3 py-2 rounded-md text-lg font-medium transition duration-300 ease-in-out transform hover:scale-105 hover:bg-gray-700">Contact</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="app-content" class="flex-grow container mx-auto p-4">
        <!-- Content will be loaded here by JavaScript -->
        <div class="flex justify-center items-center h-screen text-xl text-gray-700">
            Chargement de l'application...
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-4 text-center mt-8">
        <p>&copy; 2025 CENTRAL CARS. Tous droits réservés.</p>
        <p id="user-id-display" class="text-sm mt-1">ID Utilisateur: Non connecté (Authentification désactivée)</p>
    </footer>

    <!-- Admin Password Modal -->
    <div id="admin-password-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 items-center justify-center z-50 p-4 modal-hidden">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 text-center">Accès Administrateur</h2>
            <input type="password" id="admin-password-input" placeholder="Mot de passe administrateur" class="w-full p-3 mb-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <p id="admin-password-error" class="text-red-500 text-sm mb-4 hidden"></p>
            <div class="flex justify-end space-x-4">
                <button id="admin-password-cancel" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105">Annuler</button>
                <button id="admin-password-submit" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out transform hover:scale-105">Accéder</button>
            </div>
        </div>
    </div>

    <!-- Vehicle Detail Modal -->
    <div id="vehicle-detail-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 items-center justify-center z-50 p-4 modal-hidden">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto relative">
            <button id="detail-close-button" class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-3xl font-bold">&times;</button>
            <h2 id="detail-title" class="text-3xl font-bold text-blue-700 mb-4 text-center"></h2>
            <div class="flex flex-col md:flex-row gap-6 mb-6">
                <div class="md:w-1/2 relative">
                    <img id="detail-image" src="" alt="Image du véhicule" class="w-full h-auto rounded-lg shadow-md cursor-pointer" />
                    <button id="prev-image" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-gray-800 bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition hidden">&#10094;</button>
                    <button id="next-image" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gray-800 bg-opacity-50 text-white p-2 rounded-full hover:bg-opacity-75 transition hidden">&#10095;</button>
                    <div id="image-counter" class="absolute bottom-2 left-0 right-0 text-center text-white text-sm bg-gray-800 bg-opacity-50 py-1 rounded-b-lg hidden"></div>
                </div>
                <div class="md:w-1/2 text-gray-800">
                    <p class="text-xl font-semibold mb-2">Prix: <span id="detail-price"></span></p>
                    <p class="text-sm text-gray-600 mb-4">Tous les prix sont TTC, hors prix carte grise.</p>
                    <p class="mb-2"><strong class="text-blue-600">Année:</strong> <span id="detail-year"></span></p>
                    <p class="mb-2"><strong class="text-blue-600">Kilométrage:</strong> <span id="detail-mileage"></span> km</p>
                    <p class="mb-2"><strong class="text-blue-600">Motorisation:</strong> <span id="detail-engine-type"></span></p>
                    <p class="mb-2"><strong class="text-blue-600">Boîte de vitesse:</strong> <span id="detail-gearbox-type"></span></p>
                    <p class="mb-2"><strong class="text-blue-600">Carburant:</strong> <span id="detail-fuel-type"></span></p>
                    <p class="mb-2"><strong class="text-blue-600">Puissance fiscale:</strong> <span id="detail-tax-horsepower"></span> CV</p>
                    <p class="mb-2"><strong class="text-blue-600">Puissance (ch):</strong> <span id="detail-steam-horsepower"></span> ch</p>
                </div>
            </div>
            <div class="text-gray-800 mb-4">
                <h3 class="text-xl font-semibold text-blue-600 mb-2">Description:</h3>
                <p id="detail-description" class="text-gray-700"></p>
            </div>
            <div id="detail-options-section" class="text-gray-800 hidden">
                <h3 class="text-xl font-semibold text-blue-600 mb-2">Options:</h3>
                <ul id="detail-options" class="list-disc list-inside ml-4 grid grid-cols-1 sm:grid-cols-2 gap-1"></ul>
            </div>
            <div class="mt-6 flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="detail-close-button-bottom" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105">Fermer</button>
                <a id="call-garage-button" href="tel:+33327XXXXXXX" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105 text-center">Appeler le garage</a>
            </div>
        </div>
    </div>

    <!-- Fullscreen Image Modal -->
    <div id="fullscreen-image-modal" class="fixed inset-0 bg-gray-900 bg-opacity-90 items-center justify-center z-[100] p-4 modal-hidden">
        <button id="fullscreen-close-button" class="absolute top-4 right-4 text-white text-4xl font-bold z-[101] hover:scale-110 transition-transform">&times;</button>
        <img id="fullscreen-image" src="" alt="Image en plein écran" class="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl" />
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // IMPORTANT: REMPLACEZ LES VALEURS CI-DESSOUS PAR CELLES DE VOTRE firebaseConfig
        // Vous les trouverez dans les paramètres de votre projet Firebase (icône roue dentée -> Paramètres du projet -> Vos applications -> Web app)
        const __app_id = 'central-cars-a37ae'; // Ex: '1:1234567890:web:abcdef1234567890abcdef12'
        const __firebase_config = JSON.stringify({
           apiKey: "AIzaSyC1RQ5m7_utiAEsvyobIuuwxzAzBLx27Sw",
            authDomain: "central-cars-a37ae.firebaseapp.com",
            projectId: "central-cars-a37ae",
            storageBucket: "central-cars-a37ae.firebasestorage.app",
            messagingSenderId: "297273470734",
            appId: "1:297273470734:web:7d35e6619b28dc569d715f",
            measurementId: "G-4LXQG2VWP2"
        });
        // __initial_auth_token n'est plus utilisé car l'authentification Firebase est désactivée.
        const __initial_auth_token = '';


        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // Seuls les modules Firestore et Storage sont nécessaires maintenant
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Global variables for app state
        let currentPage = 'home';
        let isAdmin = false; // Géré par mot de passe simple
        let vehicles = [];
        let selectedVehicle = null;
        let currentImageIndex = 0;

        // Firebase configuration and initialization
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-central-cars-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app); // Initialisation de Firebase Storage

        // DOM Elements
        const appContent = document.getElementById('app-content');
        const userIdDisplay = document.getElementById('user-id-display'); // Sera mis à jour pour refléter l'absence d'authentification
        
        // Nouveaux éléments pour la modale Admin
        const adminPasswordModal = document.getElementById('admin-password-modal');
        const adminPasswordInput = document.getElementById('admin-password-input');
        const adminPasswordError = document.getElementById('admin-password-error');
        const adminPasswordCancelButton = document.getElementById('admin-password-cancel');
        const adminPasswordSubmitButton = document.getElementById('admin-password-submit');

        const vehicleDetailModal = document.getElementById('vehicle-detail-modal');
        const detailCloseButton = document.getElementById('detail-close-button');
        const detailCloseButtonBottom = document.getElementById('detail-close-button-bottom');
        const detailTitle = document.getElementById('detail-title');
        const detailImage = document.getElementById('detail-image');
        const prevImageButton = document.getElementById('prev-image');
        const nextImageButton = document.getElementById('next-image');
        const imageCounter = document.getElementById('image-counter');
        const detailPrice = document.getElementById('detail-price');
        const detailYear = document.getElementById('detail-year');
        const detailMileage = document.getElementById('detail-mileage');
        const detailEngineType = document.getElementById('detail-engine-type');
        const detailGearboxType = document.getElementById('detail-gearbox-type');
        const detailFuelType = document.getElementById('detail-fuel-type');
        const detailTaxHorsepower = document.getElementById('detail-tax-horsepower');
        const detailSteamHorsepower = document.getElementById('detail-steam-horsepower');
        const detailDescription = document.getElementById('detail-description');
        const detailOptionsSection = document.getElementById('detail-options-section');
        const detailOptionsList = document.getElementById('detail-options');
        const callGarageButton = document.getElementById('call-garage-button');

        const fullscreenImageModal = document.getElementById('fullscreen-image-modal');
        const fullscreenCloseButton = document.getElementById('fullscreen-close-button');
        const fullscreenImage = document.getElementById('fullscreen-image');

        // Nouvel élément pour le téléversement d'images
        let adminImageUploadInput; // Déclaré ici pour être accessible globalement après le rendu de la page admin
        let adminUploadStatus; // Déclaré ici pour être accessible globalement après le rendu de la page admin


        // --- Page Content Templates ---

        const homePageContent = `
            <div class="bg-white p-8 rounded-lg shadow-xl text-gray-800 my-8">
                <h1 class="text-5xl font-extrabold text-center text-blue-700 mb-8">Bienvenue chez CENTRAL CARS</h1>
                <p class="text-lg leading-relaxed mb-6 text-center max-w-3xl mx-auto">
                    Votre destination de confiance pour l'achat, la vente et l'entretien de véhicules de qualité. Chez CENTRAL CARS, nous nous engageons à vous offrir une expérience client exceptionnelle et des services automobiles fiables.
                </p>
                <div class="grid md:grid-cols-2 gap-8 mt-10">
                    <div class="flex flex-col items-center text-center">
                        <svg class="w-16 h-16 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm0 6a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2zm0 6a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z" clip-rule="evenodd"></path>
                        </svg>
                        <h3 class="text-2xl font-semibold mb-2">Notre Mission</h3>
                        <p class="text-gray-700">Fournir des véhicules inspectés et garantis, ainsi que des services d'entretien de premier ordre pour assurer votre tranquillité d'esprit sur la route.</p>
                    </div>
                    <div class="flex flex-col items-center text-center">
                        <svg class="w-16 h-16 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path>
                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path>
                        </svg>
                        <h3 class="text-2xl font-semibold mb-2">Notre Vision</h3>
                        <p class="text-gray-700">Devenir le leader reconnu de l'industrie automobile locale, en bâtissant des relations durables basées sur la confiance et l'excellence.</p>
                    </div>
                </div>
                <div class="mt-12 text-center">
                    <img
                        src="https://placehold.co/800x400/ADD8E6/000000?text=Garage+CENTRAL+CARS"
                        alt="Image du garage CENTRAL CARS"
                        class="rounded-lg shadow-md mx-auto w-full max-w-4xl"
                        onerror="this.onerror=null;this.src='https://placehold.co/800x400/ADD8E6/000000?text=Image+non+disponible';"
                    />
                </div>
            </div>
        `;

        const servicesPageContent = `
            <div class="bg-white p-8 rounded-lg shadow-xl text-gray-800 my-8">
                <h1 class="text-4xl font-bold text-center text-blue-700 mb-8">Nos Services</h1>
                <p class="text-lg leading-relaxed mb-6 text-center max-w-3xl mx-auto">
                    Chez CENTRAL CARS, nous offrons une gamme complète de services pour répondre à tous vos besoins automobiles.
                </p>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mt-10">
                    <div class="bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-1 transition duration-300 ease-in-out flex flex-col items-center text-center">
                        <svg class="w-12 h-12 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zM8.707 9.293a1 1 0 00-1.414 1.414L8.586 12l-1.293 1.293a1 1 0 101.414 1.414L10 13.414l1.293 1.293a1 1 0 001.414-1.414L11.414 12l1.293-1.293a1 1 0 00-1.414-1.414L10 10.586 8.707 9.293z"></path></svg>
                        <h3 class="text-2xl font-semibold text-gray-900 mb-3">Entretien et Réparation</h3>
                        <p class="text-gray-700">Vidange, freins, pneus, diagnostic électronique, et toutes réparations mécaniques.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-1 transition duration-300 ease-in-out flex flex-col items-center text-center">
                        <svg class="w-12 h-12 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20"><path d="M7 3a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V4a1 1 0 00-1-1H7zM7 7a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V8a1 1 0 00-1-1H7zM7 11a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1v-1a1 1 0 00-1-1H7zM4 4a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V5a1 1 0 00-1-1H4zM4 8a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V9a1 1 0 00-1-1H4zM4 12a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1v-1a1 1 0 00-1-1H4zM11 4a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V5a1 1 0 00-1-1h-2zM11 8a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1V9a1 1 0 00-1-1h-2zM11 12a1 1 0 00-1 1v1a1 1 0 001 1h2a1 1 0 001-1v-1a1 1 0 00-1-1h-2z"></path></svg>
                        <h3 class="text-2xl font-semibold text-gray-900 mb-3">Vente de Véhicules d'Occasion</h3>
                        <p class="text-gray-700">Large sélection de véhicules d'occasion inspectés et garantis, adaptés à tous les budgets.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-1 transition duration-300 ease-in-out flex flex-col items-center text-center">
                        <svg class="w-12 h-12 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 10.586V6z"></path></svg>
                        <h3 class="text-2xl font-semibold text-gray-900 mb-3">Financement Automobile</h3>
                        <p class="text-gray-700">Solutions de financement personnalisées pour faciliter l'acquisition de votre prochain véhicule.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-1 transition duration-300 ease-in-out flex flex-col items-center text-center">
                        <svg class="w-12 h-12 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z"></path><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"></path></svg>
                        <h3 class="text-2xl font-semibold text-gray-900 mb-3">Carrosserie et Peinture</h3>
                        <p class="text-gray-700">Réparation des dommages de carrosserie et travaux de peinture pour redonner un coup de neuf à votre véhicule.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-1 transition duration-300 ease-in-out flex flex-col items-center text-center">
                        <svg class="w-12 h-12 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l3 3a1 1 0 001.414-1.414L11 10.586V6z"></path></svg>
                        <h3 class="text-2xl font-semibold text-gray-900 mb-3">Contrôle Technique</h3>
                        <p class="text-gray-700">Préparation et présentation de votre véhicule au contrôle technique pour assurer sa conformité.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-1 transition duration-300 ease-in-out flex flex-col items-center text-center">
                        <svg class="w-12 h-12 text-blue-600 mb-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                        <h3 class="text-2xl font-semibold text-gray-900 mb-3">Nettoyage et Esthétique</h3>
                        <p class="text-gray-700">Nettoyage intérieur et extérieur, polissage, et traitement de protection pour une voiture impeccable.</p>
                    </div>
                </div>
            </div>
        `;

        const contactPageContent = `
            <div class="bg-white p-8 rounded-lg shadow-xl text-gray-800 my-8">
                <h1 class="text-4xl font-bold text-center text-blue-700 mb-8">Nous Contacter</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-2xl font-semibold mb-4">Informations de Contact</h2>
                        <p class="mb-2"><strong class="text-blue-600">Adresse:</strong> 576 rue Marcel Sembat, 59690 Vieux Condé, France</p>
                        <p class="mb-2"><strong class="text-blue-600">Téléphone:</strong> 0698979463</p>
                        <p class="mb-2"><strong class="text-blue-600">Email:</strong> contact@centralcars.fr</p>
                        <p class="mb-2"><strong class="text-blue-600">Horaires:</strong></p>
                        <ul class="list-disc list-inside ml-4">
                            <li>Lundi - Vendredi: 09h00 - 12h00 et 14h00 - 17h30</li>
                            <li>Samedi: 09h00 - 12h00</li>
                            <li>Dimanche: Fermé</li>
                        </ul>
                        <div class="mt-6">
                            <h3 class="text-xl font-semibold mb-3">Retrouvez-nous sur la carte :</h3>
                            <div class="aspect-w-16 aspect-h-9 rounded-lg overflow-hidden shadow-md">
                                <iframe
                                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2535.8080000000003!2d3.5786483!3d50.4005083!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47c2b3f1a0e1b5f1%3A0x6d7e2e3f4a5b6c7d!2s576%20Rue%20Marcel%20Sembat%2C%2059690%20Vieux-Cond%C3%A9%2C%20France!5e0!3m2!1sen!2sfr!4v1700000000000!5m2!1sfr!2sfr"
                                    width="100%"
                                    height="300"
                                    style="border:0;"
                                    allowfullscreen=""
                                    loading="lazy"
                                    referrerpolicy="no-referrer-when-downgrade"
                                    title="Localisation de CENTRAL CARS"
                                    class="rounded-lg"
                                ></iframe>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold mb-4">Envoyez-nous un message</h2>
                        <form id="contact-form" class="space-y-4">
                            <div>
                                <label for="contact-name" class="block text-gray-700 font-medium mb-1">Nom</label>
                                <input type="text" id="contact-name" name="name" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                            </div>
                            <div>
                                <label for="contact-email" class="block text-gray-700 font-medium mb-1">Email</label>
                                <input type="email" id="contact-email" name="email" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                            </div>
                            <div>
                                <label for="contact-message" class="block text-gray-700 font-medium mb-1">Votre Message</label>
                                <textarea id="contact-message" name="message" rows="5" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105">Envoyer le Message</button>
                            <p id="contact-status-message" class="mt-4 text-center text-green-600 font-semibold"></p>
                        </form>
                    </div>
                </div>
            </div>
        `;

        // Updated Shop Page Content with Admin Access Icon
        const shopPageContent = `
            <div class="bg-white p-8 rounded-lg shadow-xl text-gray-800 my-8 relative">
                <h1 class="text-4xl font-bold text-center text-blue-700 mb-8">Notre Boutique</h1>
                <!-- Admin Access Icon -->
                <button id="shop-admin-access-icon" class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 transition-colors duration-200" aria-label="Accès Administrateur">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M11.49 4.09A10.023 10.023 0 0010 2C4.477 2 0 6.477 0 12s4.477 10 10 10 10-4.477 10-10-4.477-10-10-10zM9 14a1 1 0 00-1 1v1a1 1 0 102 0v-1a1 1 0 00-1-1zm0-6a1 1 0 00-1 1v3a1 1 0 102 0V9a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                </button>
                <div id="shop-vehicles-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Vehicles will be loaded here -->
                </div>
                <p id="no-vehicles-message" class="text-center text-xl text-gray-600 mt-8 hidden">Aucun véhicule n'est actuellement disponible à la vente. Revenez bientôt !</p>
                <div id="shop-loading" class="flex justify-center items-center h-48">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
                    <p class="ml-4 text-xl text-gray-700">Chargement des véhicules...</p>
                </div>
                <p id="shop-error" class="text-center text-xl text-red-600 mt-8 hidden"></p>
            </div>
        `;

        const antsPageContent = `
            <div class="flex-grow container mx-auto px-4 py-8 flex flex-col items-center justify-center text-center">
                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-md">
                    <h1 class="text-2xl sm:text-3xl font-bold text-slate-700 mb-6">Accès Dossier ANTS</h1>
                    <input type="text" id="maVariable" onkeypress="handleKeyPress(event)" maxlength="8" placeholder="Entrer numéro dossier" class="w-full p-3 mb-4 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-center text-lg">
                    <button id="access-dossier-button" class="w-full px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-150 ease-in-out text-lg">
                        Accéder au dossier
                    </button>
                </div>
            </div>
        `;

        const adminPageContent = `
            <div class="bg-white p-8 rounded-lg shadow-xl text-gray-800 my-8">
                <h1 class="text-4xl font-bold text-center text-blue-700 mb-8">Panneau d'Administration</h1>

                <div class="mb-12 p-6 border border-blue-200 rounded-lg shadow-md bg-blue-50">
                    <h2 class="text-3xl font-semibold text-blue-800 mb-6 text-center">Outils Administrateur</h2>
                    <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                        <button id="admin-access-ants-button" class="bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                            Accéder aux Outils ANTS
                        </button>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="admin-logout-button" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                            Quitter le mode Admin
                        </button>
                    </div>
                </div>

                <div id="admin-form-section" class="mb-12 p-6 border border-blue-200 rounded-lg shadow-md bg-blue-50">
                    <h2 id="admin-form-title" class="text-3xl font-semibold text-blue-800 mb-6 text-center">Ajouter un Nouveau Véhicule</h2>
                    <form id="admin-vehicle-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="admin-make" class="block text-gray-700 font-medium mb-1">Marque</label>
                            <input type="text" id="admin-make" name="make" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                        </div>
                        <div>
                            <label for="admin-model" class="block text-gray-700 font-medium mb-1">Modèle</label>
                            <input type="text" id="admin-model" name="model" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                        </div>
                        <div>
                            <label for="admin-year" class="block text-gray-700 font-medium mb-1">Année</label>
                            <input type="number" id="admin-year" name="year" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required />
                        </div>
                        <div>
                            <label for="admin-price" class="block text-gray-700 font-medium mb-1">Prix (€)</label>
                            <input type="number" id="admin-price" name="price" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" step="0.01" required />
                        </div>
                        <div>
                            <label for="admin-mileage" class="block text-gray-700 font-medium mb-1">Kilométrage (km)</label>
                            <input type="number" id="admin-mileage" name="mileage" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div>
                            <label for="admin-engineType" class="block text-gray-700 font-medium mb-1">Motorisation</label>
                            <input type="text" id="admin-engineType" name="engineType" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div>
                            <label for="admin-gearboxType" class="block text-gray-700 font-medium mb-1">Type de boîte de vitesse</label>
                            <input type="text" id="admin-gearboxType" name="gearboxType" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div>
                            <label for="admin-fuelType" class="block text-gray-700 font-medium mb-1">Carburant</label>
                            <input type="text" id="admin-fuelType" name="fuelType" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div>
                            <label for="admin-taxHorsepower" class="block text-gray-700 font-medium mb-1">Puissance fiscale (CV)</label>
                            <input type="number" id="admin-taxHorsepower" name="taxHorsepower" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div>
                            <label for="admin-steamHorsepower" class="block text-gray-700 font-medium mb-1">Puissance (ch)</label>
                            <input type="number" id="admin-steamHorsepower" name="steamHorsepower" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>
                        <div class="md:col-span-2">
                            <label for="admin-options" class="block text-gray-700 font-medium mb-1">Options (séparées par des virgules)</label>
                            <textarea id="admin-options" name="options" rows="2" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: GPS, Climatisation, Toit ouvrant"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label for="admin-image-upload" class="block text-gray-700 font-medium mb-1">Téléverser des Images</label>
                            <input type="file" id="admin-image-upload" name="imageUpload" multiple accept="image/*" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            <p id="admin-upload-status" class="text-sm text-gray-600 mt-2 hidden"></p>
                        </div>
                        <div class="md:col-span-2">
                            <label for="admin-imageUrls" class="block text-gray-700 font-medium mb-1">URLs des Images existantes (séparées par des virgules)</label>
                            <textarea id="admin-imageUrls" name="imageUrls" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ex: https://example.com/img1.jpg, https://example.com/img2.jpg"></textarea>
                            <p class="text-sm text-gray-500 mt-1">Les images téléversées ci-dessus seront ajoutées à cette liste.</p>
                        </div>
                        <div class="md:col-span-2">
                            <label for="admin-description" class="block text-gray-700 font-medium mb-1">Description</label>
                            <textarea id="admin-description" name="description" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                        </div>
                        <div class="md:col-span-2 flex justify-end space-x-4 mt-4">
                            <button type="button" id="admin-cancel-edit" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-3 px-6 rounded-md transition duration-300 ease-in-out transform hover:scale-105 hidden">Annuler l'édition</button>
                            <button type="submit" id="admin-submit-button" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-md shadow-lg transition duration-300 ease-in-out transform hover:scale-105">Ajouter le Véhicule</button>
                        </div>
                    </form>
                </div>

                <h2 class="text-3xl font-semibold text-gray-800 mb-6 text-center">Véhicules Actuels</h2>
                <div id="admin-vehicles-table-container" class="overflow-x-auto rounded-lg shadow-md border border-gray-200">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-200">
                            <tr>
                                <th class="py-3 px-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">Marque</th>
                                <th class="py-3 px-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">Modèle</th>
                                <th class="py-3 px-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">Année</th>
                                <th class="py-3 px-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">Prix</th>
                                <th class="py-3 px-4 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admin-vehicles-table-body">
                            <!-- Vehicles will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <p id="admin-no-vehicles-message" class="text-center text-xl text-gray-600 mt-8 hidden"></p>
                <p id="admin-error" class="text-center text-xl text-red-600 mt-8 hidden"></p>
            </div>
        `;

        // --- Core Application Logic ---

        // Function to render content based on current page
        function renderPage() {
            appContent.innerHTML = ''; // Clear current content
            switch (currentPage) {
                case 'home':
                    appContent.innerHTML = homePageContent;
                    break;
                case 'shop':
                    appContent.innerHTML = shopPageContent;
                    // Attach event listener for the new admin access icon on the shop page
                    // Use setTimeout to ensure the element is in the DOM after innerHTML update
                    setTimeout(() => {
                        const shopAdminAccessIcon = document.getElementById('shop-admin-access-icon');
                        if (shopAdminAccessIcon) {
                            shopAdminAccessIcon.addEventListener('click', showAdminPasswordModal);
                        }
                    }, 0); // Small delay
                    loadShopVehicles();
                    break;
                case 'services':
                    appContent.innerHTML = servicesPageContent;
                    break;
                case 'contact':
                    appContent.innerHTML = contactPageContent;
                    setupContactForm();
                    break;
                case 'admin':
                    if (isAdmin) {
                        appContent.innerHTML = adminPageContent;
                        // Assign the DOM elements after rendering the admin page content
                        adminImageUploadInput = document.getElementById('admin-image-upload');
                        adminUploadStatus = document.getElementById('admin-upload-status');
                        setupAdminPage();
                        loadAdminVehicles();
                    } else {
                        // If not admin, redirect to home or show access denied message
                        currentPage = 'home'; // Redirect to home if not authorized
                        renderPage(); // Re-render home page
                        alert("Accès refusé. Vous n'êtes pas autorisé à accéder au panneau d'administration.");
                    }
                    break;
                case 'ants': // New case for ANTS page
                    if (isAdmin) {
                        appContent.innerHTML = antsPageContent;
                        setupAntsPage(); // Setup ANTS specific event listeners
                    } else {
                        // Redirect to admin if not admin
                        currentPage = 'admin'; // Redirect to admin page, which will then redirect to home
                        renderPage();
                    }
                    break;
                default:
                    appContent.innerHTML = homePageContent;
            }
            updateNavbarActiveState();
        }

        // Update Navbar active state
        function updateNavbarActiveState() {
            document.querySelectorAll('nav button').forEach(button => {
                const page = button.id.replace('nav-', '');
                if (page === currentPage) {
                    button.classList.add('bg-gray-700');
                } else {
                    button.classList.remove('bg-gray-700');
                }
            });
        }

        // --- Admin Password Modal Logic ---
        const ADMIN_PASSWORD = 'Sofian59690'; // Le mot de passe administrateur

        function showAdminPasswordModal() {
            adminPasswordModal.classList.remove('modal-hidden');
            adminPasswordModal.classList.add('modal-visible');
            adminPasswordInput.value = ''; // Clear password field
            adminPasswordError.classList.add('hidden'); // Hide any previous errors
        }

        function hideAdminPasswordModal() {
            adminPasswordModal.classList.remove('modal-visible');
            adminPasswordModal.classList.add('modal-hidden');
        }

        function handleAdminPasswordSubmit() {
            const enteredPassword = adminPasswordInput.value;
            if (enteredPassword === ADMIN_PASSWORD) {
                isAdmin = true;
                hideAdminPasswordModal();
                currentPage = 'admin';
                renderPage();
            } else {
                adminPasswordError.textContent = "Mot de passe incorrect.";
                adminPasswordError.classList.remove('hidden');
            }
        }

        // --- Shop Page Logic ---
        function loadShopVehicles() {
            const shopVehiclesContainer = document.getElementById('shop-vehicles-container');
            const shopLoading = document.getElementById('shop-loading');
            const shopError = document.getElementById('shop-error');
            const noVehiclesMessage = document.getElementById('no-vehicles-message');

            // Re-attach event listener for the admin access icon if it exists in the current DOM
            const shopAdminAccessIcon = document.getElementById('shop-admin-access-icon');
            if (shopAdminAccessIcon) {
                shopAdminAccessIcon.removeEventListener('click', showAdminPasswordModal); // Prevent multiple listeners
                shopAdminAccessIcon.addEventListener('click', showAdminPasswordModal);
            }

            if (shopLoading) shopLoading.classList.remove('hidden');
            if (shopError) shopError.classList.add('hidden');
            if (noVehiclesMessage) noVehiclesMessage.classList.add('hidden');
            if (shopVehiclesContainer) shopVehiclesContainer.innerHTML = ''; // Clear previous vehicles

            // User ID display is now static as there's no Firebase Auth
            userIdDisplay.textContent = `ID Utilisateur: Non connecté (Authentification désactivée)`;

            const vehiclesCollectionRef = collection(db, `artifacts/${appId}/public/data/vehicles`);
            onSnapshot(vehiclesCollectionRef, (snapshot) => {
                vehicles = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (shopLoading) shopLoading.classList.add('hidden');

                if (vehicles.length === 0) {
                    if (noVehiclesMessage) noVehiclesMessage.classList.remove('hidden');
                } else {
                    if (noVehiclesMessage) noVehiclesMessage.classList.add('hidden');
                    shopVehiclesContainer.innerHTML = ''; // Clear before re-rendering
                    vehicles.forEach(vehicle => {
                        const imageUrl = vehicle.imageUrls && vehicle.imageUrls.length > 0 ? vehicle.imageUrls[0] : `https://placehold.co/400x250/ADD8E6/000000?text=${vehicle.make}+${vehicle.model}`;
                        const vehicleCard = document.createElement('div');
                        vehicleCard.className = "border border-gray-200 rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition duration-300 ease-in-out cursor-pointer";
                        vehicleCard.dataset.vehicleId = vehicle.id; // Store ID for click handler

                        vehicleCard.innerHTML = `
                            <img src="${imageUrl}" alt="${vehicle.make} ${vehicle.model}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x250/ADD8E6/000000?text=Image+non+disponible';" />
                            <div class="p-4">
                                <h2 class="text-2xl font-semibold text-gray-900 mb-2">${vehicle.make} ${vehicle.model}</h2>
                                <p class="text-gray-700 mb-1">Année: ${vehicle.year}</p>
                                <p class="text-gray-700 mb-3">Prix: ${new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(vehicle.price)}</p>
                                ${vehicle.engineType ? `<p class="text-gray-700 mb-1">Motorisation: ${vehicle.engineType}</p>` : ''}
                                ${vehicle.steamHorsepower ? `<p class="text-gray-700 mb-3">Puissance: ${vehicle.steamHorsepower} ch</p>` : ''}
                                <p class="text-gray-600 text-sm line-clamp-3">${vehicle.description || ''}</p>
                            </div>
                        `;
                        vehicleCard.addEventListener('click', () => showVehicleDetailModal(vehicle.id));
                        shopVehiclesContainer.appendChild(vehicleCard);
                    });
                }
            }, (err) => {
                console.error("Erreur de récupération des véhicules:", err);
                if (shopLoading) shopLoading.classList.add('hidden');
                if (shopError) shopError.textContent = "Impossible de charger les véhicules. Veuillez réessayer plus tard.";
                if (shopError) shopError.classList.remove('hidden');
            });
        }

        // --- Vehicle Detail Modal Logic ---
        function showVehicleDetailModal(vehicleId) {
            selectedVehicle = vehicles.find(v => v.id === vehicleId);
            if (!selectedVehicle) return;

            // Populate modal content
            detailTitle.textContent = `${selectedVehicle.make} ${selectedVehicle.model}`;
            detailPrice.textContent = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(selectedVehicle.price);
            detailYear.textContent = selectedVehicle.year;
            detailMileage.textContent = new Intl.NumberFormat('fr-FR').format(selectedVehicle.mileage || 0);
            detailEngineType.textContent = selectedVehicle.engineType || 'N/A';
            detailGearboxType.textContent = selectedVehicle.gearboxType || 'N/A';
            detailFuelType.textContent = selectedVehicle.fuelType || 'N/A';
            detailTaxHorsepower.textContent = selectedVehicle.taxHorsepower || 'N/A';
            detailSteamHorsepower.textContent = selectedVehicle.steamHorsepower || 'N/A';
            detailDescription.textContent = selectedVehicle.description || 'Aucune description disponible.';

            // Handle options
            detailOptionsList.innerHTML = '';
            if (selectedVehicle.options && selectedVehicle.options.length > 0) {
                selectedVehicle.options.forEach(option => {
                    const li = document.createElement('li');
                    li.textContent = option;
                    detailOptionsList.appendChild(li);
                });
                detailOptionsSection.classList.remove('hidden');
            } else {
                detailOptionsSection.classList.add('hidden');
            }

            // Handle image carousel
            currentImageIndex = 0;
            updateDetailImage();

            // Show/hide carousel navigation
            if (selectedVehicle.imageUrls && selectedVehicle.imageUrls.length > 1) {
                prevImageButton.classList.remove('hidden');
                nextImageButton.classList.remove('hidden');
                imageCounter.classList.remove('hidden');
            } else {
                prevImageButton.classList.add('hidden');
                nextImageButton.classList.add('hidden');
                imageCounter.classList.add('hidden');
            }

            vehicleDetailModal.classList.remove('modal-hidden');
            vehicleDetailModal.classList.add('modal-visible');
        }

        function updateDetailImage() {
            if (selectedVehicle && selectedVehicle.imageUrls && selectedVehicle.imageUrls.length > 0) {
                detailImage.src = selectedVehicle.imageUrls[currentImageIndex];
                detailImage.alt = `${selectedVehicle.make} ${selectedVehicle.model} - Image ${currentImageIndex + 1}`;
                imageCounter.textContent = `${currentImageIndex + 1} / ${selectedVehicle.imageUrls.length}`;
            } else {
                detailImage.src = `https://placehold.co/600x400/ADD8E6/000000?text=Image+non+disponible`;
                detailImage.alt = `Image non disponible`;
                imageCounter.textContent = '';
            }
            detailImage.onerror = function() {
                this.onerror = null;
                this.src = `https://placehold.co/600x400/ADD8E6/000000?text=Image+non+disponible`;
            };
        }

        function hideVehicleDetailModal() {
            vehicleDetailModal.classList.remove('modal-visible');
            vehicleDetailModal.classList.add('modal-hidden');
            selectedVehicle = null;
        }

        // --- Fullscreen Image Modal Logic ---
        function showFullscreenImage(imageUrl) {
            fullscreenImage.src = imageUrl;
            fullscreenImage.onerror = function() {
                this.onerror = null;
                this.src = "https://placehold.co/1200x800/ADD8E6/000000?text=Image+non+disponible";
            };
            fullscreenImageModal.classList.remove('modal-hidden');
            fullscreenImageModal.classList.add('modal-visible');
        }

        function hideFullscreenImage() {
            fullscreenImageModal.classList.remove('modal-visible');
            fullscreenImageModal.classList.add('modal-hidden');
        }

        // --- Contact Page Logic ---
        function setupContactForm() {
            const contactForm = document.getElementById('contact-form');
            const contactStatusMessage = document.getElementById('contact-status-message');
            if (contactForm) {
                contactForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const formData = new FormData(contactForm);
                    const name = formData.get('name');
                    const email = formData.get('email');
                    const message = formData.get('message');

                    console.log('Formulaire de contact soumis:', { name, email, message });
                    contactStatusMessage.textContent = 'Votre message a été envoyé avec succès ! Nous vous répondrons bientôt.';
                    contactForm.reset(); // Réinitialiser le formulaire
                    setTimeout(() => contactStatusMessage.textContent = '', 5000); // Effacer le message après 5 secondes
                });
            }
        }

        // --- Admin Page Logic ---
        let editingVehicleId = null; // Stores the ID of the vehicle being edited

        function setupAdminPage() {
            const adminVehicleForm = document.getElementById('admin-vehicle-form');
            const adminSubmitButton = document.getElementById('admin-submit-button');
            const adminCancelEditButton = document.getElementById('admin-cancel-edit');
            const adminFormTitle = document.getElementById('admin-form-title');
            const adminAccessAntsButton = document.getElementById('admin-access-ants-button');
            const adminLogoutButton = document.getElementById('admin-logout-button'); // Nouveau bouton de déconnexion admin

            if (adminVehicleForm) {
                adminVehicleForm.addEventListener('submit', handleAdminSubmit);
            }
            if (adminCancelEditButton) {
                adminCancelEditButton.addEventListener('click', resetAdminForm);
            }
            if (adminAccessAntsButton) {
                adminAccessAntsButton.addEventListener('click', () => {
                    currentPage = 'ants';
                    renderPage();
                });
            }
            if (adminLogoutButton) {
                adminLogoutButton.addEventListener('click', () => {
                    isAdmin = false; // Quitter le mode admin
                    currentPage = 'home'; // Retour à l'accueil
                    renderPage();
                    alert("Vous avez quitté le mode administrateur.");
                });
            }
        }

        async function loadAdminVehicles() {
            const adminVehiclesTableBody = document.getElementById('admin-vehicles-table-body');
            const adminNoVehiclesMessage = document.getElementById('admin-no-vehicles-message');
            const adminError = document.getElementById('admin-error');

            if (adminVehiclesTableBody) adminVehiclesTableBody.innerHTML = ''; // Clear table
            if (adminNoVehiclesMessage) adminNoVehiclesMessage.classList.add('hidden');
            if (adminError) adminError.classList.add('hidden');

            const vehiclesCollectionRef = collection(db, `artifacts/${appId}/public/data/vehicles`);
            onSnapshot(vehiclesCollectionRef, (snapshot) => {
                vehicles = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                // Sort vehicles by make and then model for consistent display
                vehicles.sort((a, b) => {
                    const makeCompare = (a.make || '').localeCompare(b.make || '');
                    if (makeCompare !== 0) return makeCompare;
                    return (a.model || '').localeCompare(b.model || '');
                });

                if (adminVehiclesTableBody) adminVehiclesTableBody.innerHTML = ''; // Clear before re-rendering

                if (vehicles.length === 0) {
                    if (adminNoVehiclesMessage) adminNoVehiclesMessage.classList.remove('hidden');
                } else {
                    if (adminNoVehiclesMessage) adminNoVehiclesMessage.classList.add('hidden');
                    vehicles.forEach(vehicle => {
                        const row = adminVehiclesTableBody.insertRow();
                        row.innerHTML = `
                            <td class="py-3 px-4 text-gray-800">${vehicle.make || 'N/A'}</td>
                            <td class="py-3 px-4 text-gray-800">${vehicle.model || 'N/A'}</td>
                            <td class="py-3 px-4 text-gray-800">${vehicle.year || 'N/A'}</td>
                            <td class="py-3 px-4 text-gray-800">${new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(vehicle.price || 0)}</td>
                            <td class="py-3 px-4 flex space-x-2">
                                <button class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-md text-sm transition duration-300 ease-in-out transform hover:scale-105 edit-btn" data-id="${vehicle.id}">Modifier</button>
                                <button class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md text-sm transition duration-300 ease-in-out transform hover:scale-105 delete-btn" data-id="${vehicle.id}">Supprimer</button>
                            </td>
                        `;
                    });

                    // Attach event listeners to new buttons
                    document.querySelectorAll('.edit-btn').forEach(button => {
                        button.addEventListener('click', (e) => handleAdminEdit(e.target.dataset.id));
                    });
                    document.querySelectorAll('.delete-btn').forEach(button => {
                        button.addEventListener('click', (e) => handleAdminDelete(e.target.dataset.id));
                    });
                }
            }, (err) => {
                console.error("Erreur de récupération des véhicules pour l'admin:", err);
                if (adminError) adminError.textContent = "Impossible de charger les véhicules.";
                if (adminError) adminError.classList.remove('hidden');
            });
        }

        async function handleAdminSubmit(e) {
            e.preventDefault();
            const formElements = e.target.elements;
            
            adminUploadStatus.textContent = 'Téléchargement des images...';
            adminUploadStatus.classList.remove('hidden');

            const uploadedImageUrls = [];
            const files = adminImageUploadInput.files; // Récupère les fichiers du nouvel input
            for (const file of files) {
                const storageRef = ref(storage, `artifacts/${appId}/vehicle_images/${file.name}-${Date.now()}`);
                try {
                    await uploadBytes(storageRef, file);
                    const downloadURL = await getDownloadURL(storageRef);
                    uploadedImageUrls.push(downloadURL);
                } catch (uploadError) {
                    console.error("Erreur lors du téléversement de l'image:", file.name, uploadError);
                    adminUploadStatus.textContent = `Erreur de téléversement pour ${file.name}. Vérifiez les règles de Storage.`;
                    adminUploadStatus.classList.remove('hidden');
                    // Continue with other files or stop, depending on desired behavior
                }
            }
            adminUploadStatus.classList.add('hidden'); // Hide status after upload attempts

            // Combine existing URLs from textarea with newly uploaded URLs
            const existingImageUrls = formElements.imageUrls.value.split(',').map(url => url.trim()).filter(url => url !== '');
            const finalImageUrls = [...existingImageUrls, ...uploadedImageUrls];

            const vehicleData = {
                make: formElements.make.value,
                model: formElements.model.value,
                year: parseInt(formElements.year.value),
                price: parseFloat(formElements.price.value),
                description: formElements.description.value,
                imageUrls: finalImageUrls, // Utilise les URLs combinées
                mileage: parseInt(formElements.mileage.value) || 0,
                engineType: formElements.engineType.value,
                gearboxType: formElements.gearboxType.value,
                fuelType: formElements.fuelType.value,
                options: formElements.options.value.split(',').map(opt => opt.trim()).filter(opt => opt !== ''),
                taxHorsepower: parseInt(formElements.taxHorsepower.value) || 0,
                steamHorsepower: parseInt(formElements.steamHorsepower.value) || 0,
            };

            try {
                if (editingVehicleId) {
                    const vehicleDocRef = doc(db, `artifacts/${appId}/public/data/vehicles`, editingVehicleId);
                    await updateDoc(vehicleDocRef, vehicleData);
                    console.log("Véhicule mis à jour avec succès !");
                } else {
                    await addDoc(collection(db, `artifacts/${appId}/public/data/vehicles`), vehicleData);
                    console.log("Véhicule ajouté avec succès !");
                }
                resetAdminForm();
            } catch (err) {
                console.error("Erreur lors de la soumission du véhicule:", err);
                alert("Erreur lors de l'enregistrement du véhicule. Vérifiez la console pour plus de détails."); // Using alert for simplicity
            }
        }

        function handleAdminEdit(id) {
            editingVehicleId = id;
            const vehicle = vehicles.find(v => v.id === id);
            if (vehicle) {
                document.getElementById('admin-form-title').textContent = 'Modifier un Véhicule';
                document.getElementById('admin-submit-button').textContent = 'Mettre à jour le Véhicule';
                document.getElementById('admin-cancel-edit').classList.remove('hidden');

                document.getElementById('admin-make').value = vehicle.make || '';
                document.getElementById('admin-model').value = vehicle.model || '';
                document.getElementById('admin-year').value = vehicle.year || '';
                document.getElementById('admin-price').value = vehicle.price || '';
                document.getElementById('admin-description').value = vehicle.description || '';
                // Populate existing image URLs into the textarea
                document.getElementById('admin-imageUrls').value = Array.isArray(vehicle.imageUrls) ? vehicle.imageUrls.join(', ') : (vehicle.imageUrls || '');
                document.getElementById('admin-mileage').value = vehicle.mileage || '';
                document.getElementById('admin-engineType').value = vehicle.engineType || '';
                document.getElementById('admin-gearboxType').value = vehicle.gearboxType || '';
                document.getElementById('admin-fuelType').value = vehicle.fuelType || '';
                document.getElementById('admin-options').value = Array.isArray(vehicle.options) ? vehicle.options.join(', ') : (vehicle.options || '');
                document.getElementById('admin-taxHorsepower').value = vehicle.taxHorsepower || '';
                document.getElementById('admin-steamHorsepower').value = vehicle.steamHorsepower || '';

                // Clear the file input when editing, so user only uploads new files if needed
                if (adminImageUploadInput) adminImageUploadInput.value = '';
                if (adminUploadStatus) adminUploadStatus.classList.add('hidden');

                document.getElementById('admin-form-section').scrollIntoView({ behavior: 'smooth' });
            }
        }

        async function handleAdminDelete(id) {
            const confirmDelete = window.confirm("Êtes-vous sûr de vouloir supprimer ce véhicule ?");
            if (confirmDelete) {
                try {
                    await deleteDoc(doc(db, `artifacts/${appId}/public/data/vehicles`, id));
                    console.log("Véhicule supprimé avec succès !");
                } catch (err) {
                    console.error("Erreur lors de la suppression du véhicule:", err);
                    alert("Erreur lors de la suppression du véhicule."); // Using alert for simplicity
                }
            }
        }

        function resetAdminForm() {
            editingVehicleId = null;
            document.getElementById('admin-form-title').textContent = 'Ajouter un Nouveau Véhicule';
            document.getElementById('admin-submit-button').textContent = 'Ajouter le Véhicule';
            document.getElementById('admin-cancel-edit').classList.add('hidden');
            document.getElementById('admin-vehicle-form').reset();
            // Clear file input and status
            if (adminImageUploadInput) adminImageUploadInput.value = '';
            if (adminUploadStatus) adminUploadStatus.classList.add('hidden');
        }

        // --- ANTS Page Logic ---
        function setupAntsPage() {
            const maVariableInput = document.getElementById("maVariable");
            const accessDossierButton = document.getElementById("access-dossier-button");

            if (maVariableInput) {
                maVariableInput.addEventListener('keypress', handleKeyPress);
            }
            if (accessDossierButton) {
                accessDossierButton.addEventListener('click', modifierLien);
            }
        }

        function modifierLien() {
            const valeurSaisie = document.getElementById("maVariable").value;
            if (valeurSaisie.trim() === "") {
                console.warn("Le numéro de dossier ne peut pas être vide.");
                alert("Veuillez entrer un numéro de dossier."); // Using alert for simplicity
                return;
            }
            const lien = 'https://mesdemarches.siv.interieur.gouv.fr/siv-tp/#/reprise/' + valeurSaisie;
            window.open(lien, '_blank'); // Open in new tab
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                modifierLien();
            }
        }

        // --- Event Listeners ---
        document.getElementById('nav-home').addEventListener('click', () => { currentPage = 'home'; renderPage(); });
        document.getElementById('nav-shop').addEventListener('click', () => { currentPage = 'shop'; renderPage(); });
        document.getElementById('nav-services').addEventListener('click', () => { currentPage = 'services'; renderPage(); });
        document.getElementById('nav-contact').addEventListener('click', () => { currentPage = 'contact'; renderPage(); });
        
        // Admin password modal event listeners
        adminPasswordCancelButton.addEventListener('click', hideAdminPasswordModal);
        adminPasswordSubmitButton.addEventListener('click', handleAdminPasswordSubmit);

        detailCloseButton.addEventListener('click', hideVehicleDetailModal);
        detailCloseButtonBottom.addEventListener('click', hideVehicleDetailModal);
        prevImageButton.addEventListener('click', () => {
            currentImageIndex = (currentImageIndex - 1 + selectedVehicle.imageUrls.length) % selectedVehicle.imageUrls.length;
            updateDetailImage();
        });
        nextImageButton.addEventListener('click', () => {
            currentImageIndex = (currentImageIndex + 1) % selectedVehicle.imageUrls.length;
            updateDetailImage();
        });
        detailImage.addEventListener('click', () => {
            if (selectedVehicle && selectedVehicle.imageUrls && selectedVehicle.imageUrls.length > 0) {
                showFullscreenImage(selectedVehicle.imageUrls[currentImageIndex]);
            }
        });

        fullscreenCloseButton.addEventListener('click', hideFullscreenImage);

        // Initial render when script loads
        document.addEventListener('DOMContentLoaded', renderPage);
    </script>
</body>
</html>
